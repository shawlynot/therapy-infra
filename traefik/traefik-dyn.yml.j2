tls:
  certificates:
    - certFile: "/etc/certs/fullchain.cer"
      keyFile: "/etc/certs/{{ cert.domain }}.key"

http:
  services:
    zitadel:
      loadBalancer:
        servers:
        - url: "h2c://zitadel:8080"
    stalwart:
      loadBalancer:
        servers:
        - url: "https://stalwart:443"
    smtp:
      loadBalancer:
        servers:
          - address: "stalwart:25"
        proxyProtocol:
          trustedIPs:
            - 172.19.0.0/16
    smtps:
      loadBalancer:
        servers:
          - address: "stalwart:465"
        proxyProtocol:
          trustedIPs:
            - 172.19.0.0/16
    imaps:
      loadBalancer:
        servers:
          - address: "stalwart:993"
        proxyProtocol:
          trustedIPs:
            - 172.19.0.0/16
  routers:
    auth:
      tls: {}
      rule: "Host(`auth.{{ cert.domain }}`)"
      service: zitadel
    mail:
      tls:
        passthrough: true
      rule: "Host(`mail.{{ cert.domain }}`)"
      service: stalwart
    smtp:
      rule: HostSNI(`*`)
      entrypoints:
        - smtp
    smtps:
      rule: HostSNI(`*`)
      entrypoints:
        - smtps
      tls:
        passthrough: true
    imaps:
      rule: HostSNI(`*`)
      entrypoints:
        - imaps
      tls:
        passthrough: true
      