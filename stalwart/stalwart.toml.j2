[tracer.console]
type = "console"
level = "trace"
ansi = true
enable = true

[authentication.fallback-admin]
user = "admin"
secret = "{{ stalwart.admin }}"

# Define the certificate named "default"
[certificate."default"]
# Path to your fullchain PEM; uses the file macro
cert        = "%{file:/etc/certs/fullchain.cer}%"
# Path to your private key PEM
private-key = "%{file:/etc/certs/{{ cert.domain }}.key}%"
# Mark this cert as the fallback when no SNI is provided
default     = true

# Tell Stalwart which named certificate to use by default
[server.tls]
certificate = "default"

[server.listener."https"]
# Listen on all interfaces, port 443
bind     = ["[::]:443"]
# HTTP (JMAP & Web-Admin) protocol
protocol = "http"
# Require implicit TLS (i.e. TLS from connect)
tls.implicit = true

[server.listener."http"]
# Listen on all interfaces, port 443
bind     = ["[::]:8080"]
# HTTP (JMAP & Web-Admin) protocol
protocol = "http"


# Inbound MTA listener - accepts mail from other MTAs
[server.listener."smtp"]
bind     = "[::]:25"
protocol = "smtp"
# No authentication required here

# Submission listener - for authenticated clients (e.g., your mail client)
[server.listener."submission"]
bind       = "[::]:587"
protocol   = "smtp"
# Require SASL auth on this listener
authentication = { mandatory = true }

# Enforce relay policy
[session.rcpt]
relay = [
  { if = "!is_empty(authenticated_as)", then = true },
  { else = false }
]

# Optional: require EHLO to be fully qualified
[session.ehlo]
require = true
reject-non-fqdn = true

[store."postgresql"]
type = "postgresql"
host = "db"
port = "5432"
database = "stalwart"
user = "stalwart"
password = "{{ db.STALWART_PG_PASS }}"
tls = false

[storage]
data = "postgresql"
fts = "postgresql"
blob = "postgresql"
lookup = "postgresql"

[directory."default"]
type = "internal"
store = "postgresql"
